{
  "Comment": "S3バケットとFSx for Lustreを作成するステートマシン",
  "StartAt": "CreateS3Bucket",
  "States": {
    "CreateS3Bucket": {
      "Type": "Task",
      "Resource": "arn:aws:states:::aws-sdk:s3:createBucket",
      "Parameters": {
        "Bucket.$": "$.bucketName",
        "CreateBucketConfiguration": {
          "LocationConstraint": "ap-northeast-1"
        }
      },
      "Next": "CreateFsxLustre"
    },
    "CreateFsxLustre": {
      "Type": "Task",
      "Resource": "arn:aws:states:::aws-sdk:fsx:createFileSystem",
      "Parameters": {
        "FileSystemType": "LUSTRE",
        "StorageCapacity": 1200,
        "SubnetId.$": "$.subnetId",
        "SecurityGroupIds.$": "$.securityGroupIds",
        "LustreConfiguration": {
          "DeploymentType": "SCRATCH_2",
          "ImportPath.$": "States.Format('s3://{}/{}', $.bucketName, $.importPrefix)",
          "ExportPath.$": "States.Format('s3://{}/{}', $.bucketName, $.exportPrefix)",
          "ImportedFileChunkSize": 1024,
          "DataCompressionType": "LZ4"
        },
        "Tags": [
          {
            "Key": "Name",
            "Value.$": "$.fileSystemName"
          }
        ]
      },
      "End": true
    }
  }
}